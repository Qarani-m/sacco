<div class="page-header">
    <h1 class="page-title">Message Thread</h1>
    <div>
        <a href="/admin/messages" class="btn btn-secondary">Back to Messages</a>
    </div>
</div>

<div class="card">
    <div class="message-thread">
        <% thread.forEach(msg => { %>
            <div class="message-item <%= msg.sender_id === user.id ? 'message-out' : 'message-in' %>">
                <div class="message-header">
                    <span class="message-sender"><%= msg.sender_name %></span>
                    <span class="message-time"><%= new Date(msg.created_at).toLocaleString() %></span>
                </div>
                <div class="message-body">
                    <%= msg.body %>
                </div>
            </div>
        <% }); %>
    </div>

    <div class="reply-box" style="margin-top: 2rem; border-top: 1px solid #E5E7EB; padding-top: 1rem;">
        <h3>Reply</h3>
        <form action="/admin/messages/<%= messageId %>/reply" method="POST">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <div class="form-group">
                <textarea name="body" rows="4" class="form-control" placeholder="Type your reply..." required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Send Reply</button>
        </form>
    </div>
</div>

<style>
    .message-thread {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    .message-item {
        padding: 1rem;
        border-radius: 8px;
        max-width: 80%;
    }
    .message-in {
        background-color: #F3F4F6;
        align-self: flex-start;
    }
    .message-out {
        background-color: #EFF6FF;
        align-self: flex-end;
        border: 1px solid #BFDBFE;
    }
    .message-header {
        display: flex;
        justify-content: space-between;
        font-size: 0.75rem;
        color: #6B7280;
        margin-bottom: 0.5rem;
    }
    .message-sender {
        font-weight: 600;
    }
</style>
